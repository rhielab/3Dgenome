## Figure2 Comparison of Micro-C data in different read depth sequencing.

### 2A. Experimental methods of Hi-C and Micro-C. 

The plots are generated by cooltools using cooltools. Please refer to [3Dgenome/figure_script_V2/figure1](https://github.com/rhielab/3Dgenome/tree/main/figure_script_V2/figure1).

### 2B. Numbers of loops identified by Mustache at different resolutions from Hi-C 1 billion, Micro-C 1 billion, Micro-C 2 billion, and Micro-C 3 billion data are shown.

We used the loop data genrated by Mustache (Roayaei Ardakany et al., 2020) for different libraries (Hi-C 1 billion; Micro-C 1,2,3 billion data) at 1kb, 2kb, 5kb, 10kb, 25kb, 50kb respectively. The plot is showing the number of loops we get at different different resolutions among libraries.

If you are interested to use Mustache, please refer to https://github.com/ay-lab/mustache for more detailed instructions. The necessary input is ```.hic``` format. Here we provide our example code to run Mustache.

Need to specify the specific chromosome when running Mustache. If the interested resolution is less than 5kb (e.g. 2kb), we used specialized settings.
```
chr_prefix="chr"
resolution=2kb
for chr_number in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 X
do
mustache -f EXAMPLE.hic \
-ch $chr_prefix$chr_number \
-r $resolution \
-st 0.7 \
-pt 0.1 \
-o output.tsv
done
```

If the interested resolution is equal or more than 5kb, we used the deafault setting.
```
chr_prefix="chr"
resolution=5kb
for chr_number in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 X
do
mustache -f EXAMPLE.hic \
-ch $chr_prefix$chr_number \
-r $resolution \
-o output.tsv
done
```

### 2C. Fractions of loops that have different lengths (distances) found from Hi-C 1 billion, Micro-C 1 billion, 2 billion, and 3 billion data are shown. 

Here we provide a script ```category_loop_distance.sh``` which is used to classify a specific loop data into different loop distance categoires. (<200kb, 200kb-400kb, 400kb-600kb, 600kb-800kb, 800kb-1Mb, > 1Mb) and summarize the fraction of each category. To use this script:

```
bash category_loop_distance.sh \
/PATH/TO/LOOPDATA
```

The deafault output path is your current working directory. You can also specify the output path:

```
bash category_loop_distance.sh \
/PATH/TO/LOOPDATA \
OUTPUT_PATH
```

Outputs include a bunch of ```.bedpe``` files for loops falling into specific category, along with a ```summary.txt``` where the number and fraction of loops detected in different categoires are shown.

### 2D. Numbers of loops shared (between any datasets) or unique among Hi-C 1 billion, Micro-C 1 billion, 2 billion, and 3 billion data.

Here we provide an in-house Rscript ```Loop_comparison.R``` to run loop intersection analysis between two libraries, using a list of loop data as the input. 

The output files in the output folder include:
- All the original loop data added with comparison 0/1 matrix.
- For each loop data, output a subforder containning the shared/unique loop data
- Summary table for the loop comparison.

See below code for usage instruction:

Load the function. To run it, make sure you have ```fuzzyjoin``` and ```dplyr``` libraries in your R environment:
```
source('Loop_comparison.R')
```

Then load the loop data. You should have at least two loop data to run this analysis. But let's use four as example here:
```
loop_1 = read.table(file = 'loop1.tsv')
loop_2 = read.table(file = 'loop2.tsv')
loop_3 = read.table(file = 'loop3.tsv')
loop_4 = read.table(file = 'loop4.tsv')
```

Create a NAMED list in your prefered order. Here, let's say the priority to assign overlap is loop_4 > loop_3 > loop_2 > loop_1, then:
```
loop_list <- list(
LOOP4 = loop_4,
LOOP3 = loop_3,
LOOP2 = loop_2,
LOOP1 = loop_1
)
```

Run the function using the list just created. The overlap will be calculated based on the priority same as the order in the list in deafault.
```
loop_comparison(
loop_list = loop_list,
output_path= './output'
)
```

Or suddendly you want a different priority. For example, loop_1 > loop_2 > loop_3 > loop_4, then:
```
loop_comparison(
loop_list = loop_list,
priority = c(4,3,2,1)
output_path= './output2'
)
```
